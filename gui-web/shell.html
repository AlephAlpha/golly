<!--
    This file is used to create golly.html via the shell-file option in Makefile.
    Originally based on Emscripten's src/shell.html.
-->
<!doctype html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Golly</title>
    <style>
        .emscripten { padding-right: 0; margin-left: auto; margin-right: auto; display: block; }
        textarea.emscripten { font-family: monospace; width: 960px; resize: none; }
        div.emscripten { text-align: center; }
        div.emscripten_border { border: 0px none; }
        /* the canvas *must not* have any border or padding, or mouse coords will be wrong */
        canvas.emscripten { border: 0px none; }
        .vspace { clear:both; }
        .ht10 { height: 10px; }
    </style>
</head>
<body>
    <script type='text/javascript'>
        function check_browser() {
            var N=navigator.appName, ua=navigator.userAgent, tem;
            var M=ua.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);
            if (M && (tem= ua.match(/version\/([\.\d]+)/i))!= null) M[2]= tem[1];
            M=M? [M[1], M[2]]: [N, navigator.appVersion, '-?'];
            var browser_name = M[0];
            var browser_version = parseInt(M[1],10); // '5.9.1' -> 5
            if (browser_name == 'Safari' && browser_version < 6) {
                // there is a nasty bug in Safari 5's JS interpreter that causes the population count
                // to become 0 after stepping a few gens (but only in QuickLife algo)
                alert('Sorry, but Golly requires Safari 6.0 or later, ' +
                      'or another WebGL-capable browser like Chrome or Firefox.');
                window.stop();
            }
            if (browser_name == 'MSIE' && browser_version < 11) {
                alert('Sorry, but Golly requires Internet Explorer 11.0 or later, ' +
                      'or another WebGL-capable browser like Chrome or Firefox.');
                window.stop();
            }
        }
        check_browser();
    </script>
    <div class="emscripten" id="status">Downloading...</div>
    <div class="emscripten">
        <progress value="0" max="100" id="progress" hidden=1></progress>  
    </div>
    <textarea class="emscripten" id="statusbar" rows="4"></textarea>
    <div class="vspace ht10"></div>
    <div class="emscripten" id="buttons">
        <button type="button" id="new" onClick="Module.buttonPress(this)">New</button>
        &nbsp;&nbsp;
        <button type="button" id="startStop" onClick="Module.buttonPress(this)">Start</button>
        <button type="button" id="next" onClick="Module.buttonPress(this)">Next</button>
        <button type="button" id="step" onClick="Module.buttonPress(this)">Step</button>
        <button type="button" id="slower" onClick="Module.buttonPress(this)">Slower</button>
        <button type="button" id="faster" onClick="Module.buttonPress(this)">Faster</button>
        <button type="button" id="step1" onClick="Module.buttonPress(this)">Step=1</button>
        <button type="button" id="reset" onClick="Module.buttonPress(this)">Reset</button>
        &nbsp;&nbsp;
        <button type="button" id="undo" onClick="Module.buttonPress(this)">Undo</button>
        <button type="button" id="redo" onClick="Module.buttonPress(this)">Redo</button>
        &nbsp;&nbsp;
        <button type="button" id="fit" onClick="Module.buttonPress(this)">Fit</button>
        <button type="button" id="zoomOut" onClick="Module.buttonPress(this)">Zoom Out</button>
        <button type="button" id="zoomIn" onClick="Module.buttonPress(this)">Zoom In</button>
        <button type="button" id="noScale" onClick="Module.buttonPress(this)">Scale=1:1</button>
        &nbsp;&nbsp;
        <button type="button" id="help" onClick="Module.buttonPress(this)">Help</button>
    </div>
    <div class="vspace ht10"></div>
    <div class="emscripten" id="settings">
        <label for="algo">Algorithm:</label>
        <select id="algo" onchange="Module.selectionChanged(this)">
            <option value="0">QuickLife</option>
            <option value="1">HashLife</option>
            <option value="2">Generations</option>
            <option value="3">JvN</option>
            <option value="4">RuleLoader</option>
        </select>
        &nbsp;&nbsp;
        <label for="grid">Grid</label><input type="checkbox" id="grid" onClick="Module.checkboxPress(this)">
        &nbsp;&nbsp;
        <label for="icons">Icons</label><input type="checkbox" id="icons" onClick="Module.checkboxPress(this)">
        &nbsp;&nbsp;
        <label for="time">Timing</label><input type="checkbox" id="time" onClick="Module.checkboxPress(this)">
        &nbsp;&nbsp;
        <label for="mode">Mode:</label>
        <select id="mode" onchange="Module.selectionChanged(this)">
            <option value="0">Draw</option>
            <option value="1">Pick</option>
            <option value="2">Select</option>
            <option value="3">Move</option>
            <option value="4">Zoom In</option>
            <option value="5">Zoom Out</option>
        </select>
    </div>
    <div class="vspace ht10"></div>
    <div class="emscripten_border">
        <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()"></canvas>
    </div>
    <script type='text/javascript'>
        var Module = {
            preRun: [],
            postRun: [],

            buttonPress: function(button) {
                _ClearStatus(); // clear any status bar message
                button.blur();  // prevent button getting focus
                if (button.id == 'new') _NewUniverse();
                if (button.id == 'startStop') _StartStop();
                if (button.id == 'next') _Next();
                if (button.id == 'step') _Step();
                if (button.id == 'slower') _GoSlower();
                if (button.id == 'faster') _GoFaster();
                if (button.id == 'step1') _StepBy1();
                if (button.id == 'reset') _Reset();
                if (button.id == 'undo') _Undo();
                if (button.id == 'redo') _Redo();
                if (button.id == 'fit') _Fit();
                if (button.id == 'zoomOut') _ZoomOut();
                if (button.id == 'zoomIn') _ZoomIn();
                if (button.id == 'noScale') _Scale1to1();
                if (button.id == 'help') _Help();
            },

            checkboxPress: function(box) {
                _ClearStatus(); // clear any status bar message
                box.blur();     // prevent checkbox getting focus
                if (box.id == 'grid') _ToggleGrid();
                if (box.id == 'icons') _ToggleIcons();
                if (box.id == 'time') _ToggleTiming();
            },

            selectionChanged: function(select) {
                _ClearStatus(); // clear any status bar message
                select.blur();  // prevent select getting focus
                if (select.id == 'algo') _AlgoChanged(select.selectedIndex);
                if (select.id == 'mode') _ModeChanged(select.selectedIndex);
            },

            setButtonLabel: function(id, label) {
                document.getElementById(id).innerHTML = label;
            },
            
            print: (function() {
                var element = document.getElementById('statusbar');
                element.value = '';
                return function(text) {
                    text = Array.prototype.slice.call(arguments).join(' ');
                    element.value += text + "\n";
                };
            })(),
            
            printErr: function(text) {
                text = Array.prototype.slice.call(arguments).join(' ');
                console.log(text);
            },
            
            canvas: document.getElementById('canvas'),
            
            setStatus: function(text) {
                if (!Module.setStatus.last) Module.setStatus.last = { time: Date.now(), text: '' };
                //!!! next test is never true???
                if (text === Module.setStatus.text) return;
                var m = text.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/);
                var now = Date.now();
                //!!! no point doing progress stuff??? (never see it!)
                if (m && now - Date.now() < 30) return; // if this is a progress update, skip it if too soon
                var statusElement = document.getElementById('status');
                var progressElement = document.getElementById('progress');
                if (m) {
                    text = m[1];
                    progressElement.value = parseInt(m[2])*100;
                    progressElement.max = parseInt(m[4])*100;
                    progressElement.hidden = false;
                } else {
                    progressElement.value = null;
                    progressElement.max = null;
                    progressElement.hidden = true;
                }
                statusElement.innerHTML = text;
            },
            
            totalDependencies: 0,
            monitorRunDependencies: function(left) {
                this.totalDependencies = Math.max(this.totalDependencies, left);
                Module.setStatus(left ? 'Preparing... (' + (this.totalDependencies-left) +
                                        '/' + this.totalDependencies + ')' : 'All downloads complete.');
            }
        }; // Module
        
        Module.setStatus('Loading Golly...');
    </script>
    {{{ SCRIPT }}}
</body>
</html>
