<!--
    This file is used to create golly.html via the shell-file option in Makefile.
    Originally based on Emscripten's src/shell.html.
-->
<!doctype html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Golly</title>
    <style>
        .emscripten { padding-right: 0; margin-left: auto; margin-right: auto; display: block; }
        textarea.emscripten {
            font-family: monospace; width: 100%; resize: none;
            border: 0px none; margin: 0px; overflow: hidden;
        }
        div.emscripten { text-align: center; }
        div.emscripten_border { border: 0px none; }
        /* the canvas must not have any border or padding, or mouse coords will be wrong */
        canvas.emscripten { position: absolute; border: 0px none; }
        html, body {
            width: 100%;
            height: 100%;
            margin: 0px;
            overflow: hidden;       /* prevents scroll bars */
        }   
        .toolbar { background: #CCC; }
        .vspace { clear: both; height: 10px; }
        .statespan { width: 24px; display: inline-block; }
        #pastemenu {
         	position: absolute;
         	z-index: 1;
            visibility: hidden;
            background: #FEE;       /* light red to match paste image */
            border: 1px solid #000;
        }
        #pastemenu span {
         	position: relative;
            display: block;
            padding: 5px 10px;
            font: bold 12px arial;
        }
	    #pastemenu span:hover {
	    	background: #000;
		    color: #FFF;
		}
        #selectionmenu {
         	position: absolute;
         	z-index: 1;
            visibility: hidden;
            background: #DFD;       /* light green to match selection */
            border: 1px solid #000;
        }
        #selectionmenu span {
         	position: relative;
            display: block;
            padding: 5px 10px;
            font: bold 12px arial;
        }
	    #selectionmenu span:hover {
	    	background: #000;
		    color: #FFF;
		}
    </style>
</head>
<body>
    <script type='text/javascript'>
        window.addEventListener('resize', function resize_canvas() {
            _ResizeCanvas();
        });

        function check_browser() {
            var N=navigator.appName, ua=navigator.userAgent, tem;
            var M=ua.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);
            if (M && (tem= ua.match(/version\/([\.\d]+)/i))!= null) M[2]= tem[1];
            M=M? [M[1], M[2]]: [N, navigator.appVersion, '-?'];
            var browser_name = M[0];
            var browser_version = parseInt(M[1],10); // '5.9.1' -> 5
            if (browser_name == 'Safari' && browser_version < 6) {
                // there is a nasty bug in Safari 5's JS interpreter that causes the population count
                // to become 0 after stepping a few gens (but only in QuickLife algo)
                alert('Sorry, but Golly requires Safari 6.0 or later, ' +
                      'or another WebGL-capable browser like Chrome or Firefox.');
                window.stop();
            }
            if (browser_name == 'MSIE' && browser_version < 11) {
                alert('Sorry, but Golly requires Internet Explorer 11.0 or later, ' +
                      'or another WebGL-capable browser like Chrome or Firefox.');
                window.stop();
            }
        };
        check_browser();
    </script>
    <div id="pastemenu" oncontextmenu="event.preventDefault()">
    <span onclick="_PasteAction(0);">Abort Paste</span>
    <span onclick="_PasteAction(1);" id="pastemode">Paste Here</span>
    <span onclick="_PasteAction(2);">Paste to Selection</span>
    <span onclick="_PasteAction(3);">Flip Top-Bottom</span>
    <span onclick="_PasteAction(4);">Flip Left-Right</span>
    <span onclick="_PasteAction(5);">Rotate Clockwise</span>
    <span onclick="_PasteAction(6);">Rotate Anticlockwise</span>
    </div>
    <div id="selectionmenu" oncontextmenu="event.preventDefault()">
    <span onclick="_SelectionAction(0);">Remove Selection</span>
    <span onclick="_SelectionAction(1);">Cut</span>
    <span onclick="_SelectionAction(2);">Copy</span>
    <span onclick="_SelectionAction(3);">Clear</span>
    <span onclick="_SelectionAction(4);">Clear Outside</span>
    <span onclick="_SelectionAction(5);">Shrink</span>
    <span onclick="_SelectionAction(6);">Fit</span>
    <span onclick="_SelectionAction(7);" id="randfill">Random Fill</span>
    <span onclick="_SelectionAction(8);">Flip Top-Bottom</span>
    <span onclick="_SelectionAction(9);">Flip Left-Right</span>
    <span onclick="_SelectionAction(10);">Rotate Clockwise</span>
    <span onclick="_SelectionAction(11);">Rotate Anticlockwise</span>
    <span onclick="_SelectionAction(12);">Advance</span>
    <span onclick="_SelectionAction(13);">Advance Outside</span>
    </div>
    <textarea class="emscripten" id="statusbar" rows="3">Loading Golly...</textarea>
    <div class="toolbar">
        <div class="vspace"></div>
        <div class="emscripten" id="buttons">
            <button type="button" id="new" onClick="Module.buttonPress(this)">New</button>
            &nbsp;&nbsp;
            <button type="button" id="startStop" onClick="Module.buttonPress(this)">Start</button>
            <button type="button" id="next" onClick="Module.buttonPress(this)">Next</button>
            <button type="button" id="step" onClick="Module.buttonPress(this)">Step</button>
            <button type="button" id="slower" onClick="Module.buttonPress(this)">Slower</button>
            <button type="button" id="faster" onClick="Module.buttonPress(this)">Faster</button>
            <button type="button" id="step1" onClick="Module.buttonPress(this)">Step=1</button>
            <button type="button" id="reset" onClick="Module.buttonPress(this)">Reset</button>
            &nbsp;&nbsp;
            <button type="button" id="undo" onClick="Module.buttonPress(this)">Undo</button>
            <button type="button" id="redo" onClick="Module.buttonPress(this)">Redo</button>
            &nbsp;&nbsp;
            <button type="button" id="fit" onClick="Module.buttonPress(this)">Fit</button>
            <button type="button" id="zoomOut" onClick="Module.buttonPress(this)">Zoom Out</button>
            <button type="button" id="zoomIn" onClick="Module.buttonPress(this)">Zoom In</button>
            <button type="button" id="noScale" onClick="Module.buttonPress(this)">Scale=1:1</button>
            &nbsp;&nbsp;
            <button type="button" id="help" onClick="Module.buttonPress(this)">Help</button>
        </div>
        <div class="vspace"></div>
        <div class="emscripten" id="settings">
            <label for="algo">Algorithm:</label>
            <select id="algo" onchange="Module.selectionChanged(this)">
                <option>QuickLife</option>
                <option>HashLife</option>
                <option>Generations</option>
                <option>JvN</option>
                <option>RuleLoader</option>
            </select>
            <button type="button" id="rule" onClick="Module.buttonPress(this)">Rule...</button>
            &nbsp;&nbsp;
            <label for="grid">Grid</label><input type="checkbox" id="grid" onClick="Module.checkboxPress(this)">
            &nbsp;&nbsp;
            <label for="icons">Icons</label><input type="checkbox" id="icons" onClick="Module.checkboxPress(this)">
            &nbsp;&nbsp;
            <label for="time">Timing</label><input type="checkbox" id="time" onClick="Module.checkboxPress(this)">
            &nbsp;&nbsp;
            <label for="mode">Cursor:</label>
            <select id="mode" onchange="Module.selectionChanged(this)">
                <option>Draw</option>
                <option>Pick</option>
                <option>Select</option>
                <option>Move</option>
                <option>Zoom In</option>
                <option>Zoom Out</option>
            </select>
            &nbsp;&nbsp;
            <span>State:</span> <span class="statespan" id="state">1</span>
            <button type="button" id="decState" onClick="Module.buttonPress(this)"> &lt; </button>
            <button type="button" id="incState" onClick="Module.buttonPress(this)"> &gt; </button>
        </div>
        <div class="vspace"></div>
    </div>
    <div class="emscripten_border">
        <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()"></canvas>
    </div>
    <script type='text/javascript'>
        var Module = {
            preRun: [],
            postRun: [],

            buttonPress: function(button) {
                _ClearStatus(); // clear any status bar message
                button.blur();  // prevent button getting focus
                if (button.id == 'new') _NewUniverse();
                if (button.id == 'startStop') _StartStop();
                if (button.id == 'next') _Next();
                if (button.id == 'step') _Step();
                if (button.id == 'slower') _GoSlower();
                if (button.id == 'faster') _GoFaster();
                if (button.id == 'step1') _StepBy1();
                if (button.id == 'reset') _Reset();
                if (button.id == 'undo') _Undo();
                if (button.id == 'redo') _Redo();
                if (button.id == 'fit') _Fit();
                if (button.id == 'zoomOut') _ZoomOut();
                if (button.id == 'zoomIn') _ZoomIn();
                if (button.id == 'noScale') _Scale1to1();
                if (button.id == 'help') _Help();
                if (button.id == 'rule') _SetRule();
                if (button.id == 'decState') _DecState();
                if (button.id == 'incState') _IncState();
            },

            checkboxPress: function(box) {
                _ClearStatus(); // clear any status bar message
                box.blur();     // prevent checkbox getting focus
                if (box.id == 'grid') _ToggleGrid();
                if (box.id == 'icons') _ToggleIcons();
                if (box.id == 'time') _ToggleTiming();
            },

            selectionChanged: function(select) {
                _ClearStatus(); // clear any status bar message
                select.blur();  // prevent select getting focus
                if (select.id == 'algo') _AlgoChanged(select.selectedIndex);
                if (select.id == 'mode') _ModeChanged(select.selectedIndex);
            },

            setButtonLabel: function(id, label) {
                document.getElementById(id).innerHTML = label;
            },
            
            print: (function() {
                var element = document.getElementById('statusbar');
                element.value = '';
                return function(text) {
                    text = Array.prototype.slice.call(arguments).join(' ');
                    element.value += text + "\n";
                };
            })(),
            
            printErr: function(text) {
                text = Array.prototype.slice.call(arguments).join(' ');
                console.log(text);
            },
            
            canvas: document.getElementById('canvas'),
        }; // Module
    </script>
    {{{ SCRIPT }}}
</body>
</html>
