<!--
    This file is used to create golly.html via the shell-file option in Makefile.
    Originally based on Emscripten's src/shell.html.
-->
<!doctype html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Golly</title>
    <style>
        .emscripten { padding-right: 0; margin-left: auto; margin-right: auto; display: block; }
        textarea.emscripten { font-family: monospace; width: 960px; }
        div.emscripten { text-align: center; }
        div.emscripten_border { border: 0px none; }
        /* the canvas *must not* have any border or padding, or mouse coords will be wrong */
        canvas.emscripten { border: 0px none; }
    </style>
</head>
<body>
    <script type='text/javascript'>
        function check_browser() {
            var N=navigator.appName, ua=navigator.userAgent, tem;
            var M=ua.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i);
            if (M && (tem= ua.match(/version\/([\.\d]+)/i))!= null) M[2]= tem[1];
            M=M? [M[1], M[2]]: [N, navigator.appVersion, '-?'];
            var browser_name = M[0];
            var browser_version = parseInt(M[1],10); // '5.9.1' -> 5
            if (browser_name == 'Safari' && browser_version < 6) {
                // there is a nasty bug in Safari 5's JS interpreter that causes the population count
                // to become 0 after stepping a few gens (but only in QuickLife algo)
                alert('Sorry, but Golly requires Safari 6.0 or later, ' +
                      'or another WebGL-capable browser like Chrome or Firefox.');
                window.stop();
            }
            if (browser_name == 'MSIE' && browser_version < 11) {
                alert('Sorry, but Golly requires Internet Explorer 11.0 or later, ' +
                      'or another WebGL-capable browser like Chrome or Firefox.');
                window.stop();
            }
        }
        check_browser();
    </script>
    <div class="emscripten" id="status">Downloading...</div>
    <div class="emscripten">
        <progress value="0" max="100" id="progress" hidden=1></progress>  
    </div>
    <textarea class="emscripten" id="output" rows="4"></textarea>
    <div class="emscripten" id="buttons">
        <button type="button" id="startStop" onClick="Module.buttonPress(this)">Start</button>
        <button type="button" id="undo" onClick="Module.buttonPress(this)">Undo</button>
        <button type="button" id="redo" onClick="Module.buttonPress(this)">Redo</button>
    </div>
    <div class="emscripten_border">
        <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()"></canvas>
    </div>
    <script type='text/javascript'>
        var Module = {
            preRun: [],
            postRun: [],
            
            print: (function() {
                var element = document.getElementById('output');
                element.value = ''; // clear browser cache
                return function(text) {
                    text = Array.prototype.slice.call(arguments).join(' ');
                    element.value += text + "\n";
                };
            })(),
            
            printErr: function(text) {
                text = Array.prototype.slice.call(arguments).join(' ');
                console.log(text);
            },
            
            canvas: document.getElementById('canvas'),

            buttonPress: function(button) {
                _ClearStatus(); // clears any status bar message
                if (button.id == 'startStop') _StartStop();
                if (button.id == 'undo') _Undo();
                if (button.id == 'redo') _Redo();
            },

            setButtonLabel: function(id, label) {
                document.getElementById(id).innerHTML = label;
            },
            
            setStatus: function(text) {
                if (!Module.setStatus.last) Module.setStatus.last = { time: Date.now(), text: '' };
                //!!! next test is never true???
                if (text === Module.setStatus.text) return;
                var m = text.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/);
                var now = Date.now();
                //!!! no point doing progress stuff??? (never see it!)
                if (m && now - Date.now() < 30) return; // if this is a progress update, skip it if too soon
                var statusElement = document.getElementById('status');
                var progressElement = document.getElementById('progress');
                if (m) {
                    text = m[1];
                    progressElement.value = parseInt(m[2])*100;
                    progressElement.max = parseInt(m[4])*100;
                    progressElement.hidden = false;
                } else {
                    progressElement.value = null;
                    progressElement.max = null;
                    progressElement.hidden = true;
                }
                statusElement.innerHTML = text;
            },
            
            totalDependencies: 0,
            monitorRunDependencies: function(left) {
                this.totalDependencies = Math.max(this.totalDependencies, left);
                Module.setStatus(left ? 'Preparing... (' + (this.totalDependencies-left) +
                                        '/' + this.totalDependencies + ')' : 'All downloads complete.');
            }
        }; // Module
        
        Module.setStatus('Loading Golly...');
    </script>
    {{{ SCRIPT }}}
</body>
</html>
